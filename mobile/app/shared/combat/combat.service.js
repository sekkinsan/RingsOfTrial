"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var http_1 = require("@angular/http");
var saver_1 = require("../../saver");
require("rxjs/add/operator/catch");
require("rxjs/add/operator/do");
require("rxjs/add/operator/map");
var room_component_1 = require("../../pages/room/room.component");
var CombatService = /** @class */ (function () {
    function CombatService(http, roomComponent, saveManager) {
        this.http = http;
        this.roomComponent = roomComponent;
        this.saveManager = saveManager;
        var combatArray = this.roomComponent.combatArray;
        var player = this.roomComponent.player;
        var enemy = this.roomComponent.enemy;
    }
    //for attack since attack isn't a spell..
    CombatService.prototype.damageDealt = function () {
        if (this.roomComponent.player.mana >= 0) {
            this.roomComponent.combatArray.push("You are about to use " + this.roomComponent.attack);
            this.roomComponent.enemy.health = this.roomComponent.enemy.health - 2;
            this.roomComponent.player.mana = this.roomComponent.player.mana - 0;
            this.roomComponent.combatArray.push("You dealt 2 damage");
            this.roomComponent.combatArray.push('You used 0 mana');
            this.damageReceived();
            this.failRoom();
        }
        else {
            this.roomComponent.combatArray.push("You don't have enough mana!");
        }
        console.log(JSON.stringify(this.roomComponent.combatArray));
        this.clearCombatArray();
        console.log(JSON.stringify(this.roomComponent.combatArray));
    };
    //for player spells, can refactor...
    CombatService.prototype.useSpell1 = function () {
        if (this.roomComponent.player.mana >= this.roomComponent.player.spells[0].mana) {
            this.roomComponent.combatArray.push("You are about to use " + this.roomComponent.player.spells[0].name);
            this.roomComponent.enemy.health = this.roomComponent.enemy.health - this.roomComponent.player.spells[0].damage;
            this.roomComponent.player.mana = this.roomComponent.player.mana - this.roomComponent.player.spells[0].mana;
            this.roomComponent.combatArray.push("You dealt " + this.roomComponent.player.spells[0].damage + " damage");
            this.roomComponent.combatArray.push("You used " + this.roomComponent.player.spells[0].mana + " mana");
            this.damageReceived();
            this.failRoom();
        }
        else {
            this.roomComponent.combatArray.push("You don't have enough mana!");
        }
        console.log(JSON.stringify(this.roomComponent.combatArray));
        this.clearCombatArray();
        console.log(JSON.stringify(this.roomComponent.combatArray));
    };
    CombatService.prototype.useSpell2 = function () {
        if (this.roomComponent.player.mana >= this.roomComponent.player.spells[1].mana) {
            this.roomComponent.combatArray.push("You are about to use " + this.roomComponent.player.spells[1].name);
            this.roomComponent.enemy.health = this.roomComponent.enemy.health - this.roomComponent.player.spells[1].damage;
            this.roomComponent.player.mana = this.roomComponent.player.mana - this.roomComponent.player.spells[1].mana;
            this.roomComponent.combatArray.push("You dealt " + this.roomComponent.player.spells[1].damage + " damage");
            this.roomComponent.combatArray.push("You used " + this.roomComponent.player.spells[1].mana + " mana");
            this.damageReceived();
            this.failRoom();
        }
        else {
            this.roomComponent.combatArray.push("You don't have enough mana!");
        }
        console.log(JSON.stringify(this.roomComponent.combatArray));
        this.clearCombatArray();
        console.log(JSON.stringify(this.roomComponent.combatArray));
    };
    CombatService.prototype.damageReceived = function () {
        if (this.roomComponent.enemy.health <= 0) {
            return this.clearRoom();
        }
        var enemySpell = this.roomComponent.getEnemySpell();
        this.roomComponent.combatArray.push("ENEMY CAST " + enemySpell.name);
        this.roomComponent.enemy.mana = this.roomComponent.enemy.mana - enemySpell.mana;
        this.roomComponent.player.health = this.roomComponent.player.health - enemySpell.damage;
        this.roomComponent.combatArray.push("You lost " + enemySpell.damage + " hp");
        console.log(JSON.stringify(this.roomComponent.combatArray));
    };
    CombatService.prototype.clearRoom = function () {
        if (this.roomComponent.enemy.health <= 0) {
            alert("YOU CLEARED THIS ROOM!");
        }
        this.roomComponent.cleared = true;
    };
    CombatService.prototype.failRoom = function () {
        if (this.roomComponent.player.health <= 0) {
            alert("YOU FAILED THIS ROOM!");
        }
        this.roomComponent.cleared = false;
    };
    CombatService.prototype.displayCombatArray = function () {
    };
    CombatService.prototype.clearCombatArray = function () {
        this.roomComponent.combatArray = [];
    };
    CombatService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [http_1.Http, room_component_1.RoomComponent, saver_1.SaveManager])
    ], CombatService);
    return CombatService;
}());
exports.CombatService = CombatService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYmF0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjb21iYXQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUEyQztBQUMzQyxzQ0FBb0U7QUFHcEUscUNBQTBDO0FBTzFDLG1DQUFpQztBQUNqQyxnQ0FBOEI7QUFDOUIsaUNBQStCO0FBQy9CLGtFQUFnRTtBQUtoRTtJQUdFLHVCQUFvQixJQUFVLEVBQVUsYUFBNEIsRUFBVSxXQUF3QjtRQUFsRixTQUFJLEdBQUosSUFBSSxDQUFNO1FBQVUsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFBVSxnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUNwRyxJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQztRQUNqRCxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQztRQUN2QyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQztJQUd2QyxDQUFDO0lBQ0QseUNBQXlDO0lBQ3pDLG1DQUFXLEdBQVg7UUFDRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN4QyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsMEJBQXdCLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBUSxDQUFDLENBQUE7WUFDeEYsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDdEUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7WUFDcEUsSUFBSSxDQUFDLGFBQWEs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QVQ7UUFDSSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6QyxLQUFLLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUNsQyxDQUFDO1FBQ0QsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO0lBQ3RDLENBQUM7SUFFRCxnQ0FBUSxHQUFSO1FBQ0UsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDMUMsS0FBSyxDQUFDLHVCQUF1QixDQUFDLENBQUE7UUFDaEMsQ0FBQztRQUNELElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztJQUNyQyxDQUFDO0lBRUQsMENBQWtCLEdBQWxCO0lBRUEsQ0FBQztJQUVELHdDQUFnQixHQUFoQjtRQUNFLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztJQUN0QyxDQUFDO0lBbEdVLGFBQWE7UUFEekIsaUJBQVUsRUFBRTt5Q0FJZSxXQUFJLEVBQXlCLDhCQUFhLEVBQXVCLG1CQUFXO09BSDNGLGFBQWEsQ0FvR3pCO0lBQUQsb0JBQUM7Q0FBQSxBQXBHRCxJQW9HQztBQXBHWSxzQ0FBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBIdHRwLCBIZWFkZXJzLCBSZXNwb25zZSwgSHR0cE1vZHVsZSB9IGZyb20gXCJAYW5ndWxhci9odHRwXCI7XHJcbmltcG9ydCB7IEh0dHBDbGllbnRNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqcy9PYnNlcnZhYmxlXCI7XHJcbmltcG9ydCB7IFNhdmVNYW5hZ2VyIH0gZnJvbSBcIi4uLy4uL3NhdmVyXCI7XHJcbmltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuLi8uLi9tb2RlbHMvUGxheWVyXCI7XHJcbmltcG9ydCB7IEVuZW15IH0gZnJvbSBcIi4uLy4uL21vZGVscy9FbmVteVwiO1xyXG5pbXBvcnQgeyBSb29tIH0gZnJvbSBcIi4uLy4uL21vZGVscy9Sb29tXCI7XHJcbmltcG9ydCB7IFpvbmUgfSBmcm9tIFwiLi4vLi4vbW9kZWxzL1pvbmVcIjtcclxuaW1wb3J0IHsgU3BlbGwgfSBmcm9tIFwiLi4vLi4vbW9kZWxzL3NwZWxsXCI7XHJcbmltcG9ydCB7IENvbmZpZyB9IGZyb20gXCIuLi9jb25maWdcIjtcclxuaW1wb3J0IFwicnhqcy9hZGQvb3BlcmF0b3IvY2F0Y2hcIjtcclxuaW1wb3J0IFwicnhqcy9hZGQvb3BlcmF0b3IvZG9cIjtcclxuaW1wb3J0IFwicnhqcy9hZGQvb3BlcmF0b3IvbWFwXCI7XHJcbmltcG9ydCB7IFJvb21Db21wb25lbnQgfSBmcm9tIFwiLi4vLi4vcGFnZXMvcm9vbS9yb29tLmNvbXBvbmVudFwiO1xyXG5cclxuXHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBDb21iYXRTZXJ2aWNlIHtcclxuXHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cCwgcHJpdmF0ZSByb29tQ29tcG9uZW50OiBSb29tQ29tcG9uZW50LCBwcml2YXRlIHNhdmVNYW5hZ2VyOiBTYXZlTWFuYWdlcjspIHtcclxuICAgIGxldCBjb21iYXRBcnJheSA9IHRoaXMucm9vbUNvbXBvbmVudC5jb21iYXRBcnJheTtcclxuICAgIGxldCBwbGF5ZXIgPSB0aGlzLnJvb21Db21wb25lbnQucGxheWVyO1xyXG4gICAgbGV0IGVuZW15ID0gdGhpcy5yb29tQ29tcG9uZW50LmVuZW15O1xyXG5cclxuICAgIFxyXG4gIH1cclxuICAvL2ZvciBhdHRhY2sgc2luY2UgYXR0YWNrIGlzbid0IGEgc3BlbGwuLlxyXG4gIGRhbWFnZURlYWx0KCl7XHJcbiAgICBpZiAodGhpcy5yb29tQ29tcG9uZW50LnBsYXllci5tYW5hID49IDApIHtcclxuICAgICAgdGhpcy5yb29tQ29tcG9uZW50LmNvbWJhdEFycmF5LnB1c2goYFlvdSBhcmUgYWJvdXQgdG8gdXNlICR7dGhpcy5yb29tQ29tcG9uZW50LmF0dGFja31gKVxyXG4gICAgICB0aGlzLnJvb21Db21wb25lbnQuZW5lbXkuaGVhbHRoID0gdGhpcy5yb29tQ29tcG9uZW50LmVuZW15LmhlYWx0aCAtIDI7XHJcbiAgICAgIHRoaXMucm9vbUNvbXBvbmVudC5wbGF5ZXIubWFuYSA9IHRoaXMucm9vbUNvbXBvbmVudC5wbGF5ZXIubWFuYSAtIDA7XHJcbiAgICAgIHRoaXMucm9vbUNvbXBvbmVudC5jb21iYXRBcnJheS5wdXNoKGBZb3UgZGVhbHQgMiBkYW1hZ2VgKVxyXG4gICAgICB0aGlzLnJvb21Db21wb25lbnQuY29tYmF0QXJyYXkucHVzaCgnWW91IHVzZWQgMCBtYW5hJyk7XHJcbiAgICAgIHRoaXMuZGFtYWdlUmVjZWl2ZWQoKTtcclxuICAgICAgdGhpcy5mYWlsUm9vbSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5yb29tQ29tcG9uZW50LmNvbWJhdEFycmF5LnB1c2goXCJZb3UgZG9uJ3QgaGF2ZSBlbm91Z2ggbWFuYSFcIik7XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh0aGlzLnJvb21Db21wb25lbnQuY29tYmF0QXJyYXkpKTtcclxuICAgIHRoaXMuY2xlYXJDb21iYXRBcnJheSgpO1xyXG4gICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkodGhpcy5yb29tQ29tcG9uZW50LmNvbWJhdEFycmF5KSk7XHJcbiAgfVxyXG5cclxuICAvL2ZvciBwbGF5ZXIgc3BlbGxzLCBjYW4gcmVmYWN0b3IuLi5cclxuICB1c2VTcGVsbDEoKXtcclxuICAgIGlmICh0aGlzLnJvb21Db21wb25lbnQucGxheWVyLm1hbmEgPj0gdGhpcy5yb29tQ29tcG9uZW50LnBsYXllci5zcGVsbHNbMF0ubWFuYSkge1xyXG4gICAgICB0aGlzLnJvb21Db21wb25lbnQuY29tYmF0QXJyYXkucHVzaChgWW91IGFyZSBhYm91dCB0byB1c2UgJHt0aGlzLnJvb21Db21wb25lbnQucGxheWVyLnNwZWxsc1swXS5uYW1lfWApXHJcbiAgICAgIHRoaXMucm9vbUNvbXBvbmVudC5lbmVteS5oZWFsdGggPSB0aGlzLnJvb21Db21wb25lbnQuZW5lbXkuaGVhbHRoIC0gdGhpcy5yb29tQ29tcG9uZW50LnBsYXllci5zcGVsbHNbMF0uZGFtYWdlO1xyXG4gICAgICB0aGlzLnJvb21Db21wb25lbnQucGxheWVyLm1hbmEgPSB0aGlzLnJvb21Db21wb25lbnQucGxheWVyLm1hbmEgLSB0aGlzLnJvb21Db21wb25lbnQucGxheWVyLnNwZWxsc1swXS5tYW5hO1xyXG4gICAgICB0aGlzLnJvb21Db21wb25lbnQuY29tYmF0QXJyYXkucHVzaChgWW91IGRlYWx0ICR7dGhpcy5yb29tQ29tcG9uZW50LnBsYXllci5zcGVsbHNbMF0uZGFtYWdlfSBkYW1hZ2VgKVxyXG4gICAgICB0aGlzLnJvb21Db21wb25lbnQuY29tYmF0QXJyYXkucHVzaChgWW91IHVzZWQgJHt0aGlzLnJvb21Db21wb25lbnQucGxheWVyLnNwZWxsc1swXS5tYW5hfSBtYW5hYCk7XHJcbiAgICAgIHRoaXMuZGFtYWdlUmVjZWl2ZWQoKTtcclxuICAgICAgdGhpcy5mYWlsUm9vbSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5yb29tQ29tcG9uZW50LmNvbWJhdEFycmF5LnB1c2goXCJZb3UgZG9uJ3QgaGF2ZSBlbm91Z2ggbWFuYSFcIik7XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh0aGlzLnJvb21Db21wb25lbnQuY29tYmF0QXJyYXkpKTtcclxuICAgIHRoaXMuY2xlYXJDb21iYXRBcnJheSgpO1xyXG4gICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkodGhpcy5yb29tQ29tcG9uZW50LmNvbWJhdEFycmF5KSk7XHJcbiAgfVxyXG5cclxuICB1c2VTcGVsbDIoKXtcclxuICAgIGlmICh0aGlzLnJvb21Db21wb25lbnQucGxheWVyLm1hbmEgPj0gdGhpcy5yb29tQ29tcG9uZW50LnBsYXllci5zcGVsbHNbMV0ubWFuYSkge1xyXG4gICAgICB0aGlzLnJvb21Db21wb25lbnQuY29tYmF0QXJyYXkucHVzaChgWW91IGFyZSBhYm91dCB0byB1c2UgJHt0aGlzLnJvb21Db21wb25lbnQucGxheWVyLnNwZWxsc1sxXS5uYW1lfWApXHJcbiAgICAgIHRoaXMucm9vbUNvbXBvbmVudC5lbmVteS5oZWFsdGggPSB0aGlzLnJvb21Db21wb25lbnQuZW5lbXkuaGVhbHRoIC0gdGhpcy5yb29tQ29tcG9uZW50LnBsYXllci5zcGVsbHNbMV0uZGFtYWdlO1xyXG4gICAgICB0aGlzLnJvb21Db21wb25lbnQucGxheWVyLm1hbmEgPSB0aGlzLnJvb21Db21wb25lbnQucGxheWVyLm1hbmEgLSB0aGlzLnJvb21Db21wb25lbnQucGxheWVyLnNwZWxsc1sxXS5tYW5hO1xyXG4gICAgICB0aGlzLnJvb21Db21wb25lbnQuY29tYmF0QXJyYXkucHVzaChgWW91IGRlYWx0ICR7dGhpcy5yb29tQ29tcG9uZW50LnBsYXllci5zcGVsbHNbMV0uZGFtYWdlfSBkYW1hZ2VgKVxyXG4gICAgICB0aGlzLnJvb21Db21wb25lbnQuY29tYmF0QXJyYXkucHVzaChgWW91IHVzZWQgJHt0aGlzLnJvb21Db21wb25lbnQucGxheWVyLnNwZWxsc1sxXS5tYW5hfSBtYW5hYCk7XHJcbiAgICAgIHRoaXMuZGFtYWdlUmVjZWl2ZWQoKTtcclxuICAgICAgdGhpcy5mYWlsUm9vbSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5yb29tQ29tcG9uZW50LmNvbWJhdEFycmF5LnB1c2goXCJZb3UgZG9uJ3QgaGF2ZSBlbm91Z2ggbWFuYSFcIik7XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh0aGlzLnJvb21Db21wb25lbnQuY29tYmF0QXJyYXkpKTtcclxuICAgIHRoaXMuY2xlYXJDb21iYXRBcnJheSgpO1xyXG4gICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkodGhpcy5yb29tQ29tcG9uZW50LmNvbWJhdEFycmF5KSk7XHJcbiAgfVxyXG5cclxuXHJcblxyXG4gIGRhbWFnZVJlY2VpdmVkKCl7XHJcbiAgICBpZiAodGhpcy5yb29tQ29tcG9uZW50LmVuZW15LmhlYWx0aCA8PSAwKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmNsZWFyUm9vbSgpO1xyXG4gICAgfVxyXG4gICAgbGV0IGVuZW15U3BlbGw6U3BlbGwgPSB0aGlzLnJvb21Db21wb25lbnQuZ2V0RW5lbXlTcGVsbCgpO1xyXG4gICAgdGhpcy5yb29tQ29tcG9uZW50LmNvbWJhdEFycmF5LnB1c2goYEVORU1ZIENBU1QgJHtlbmVteVNwZWxsLm5hbWV9YCk7XHJcbiAgICB0aGlzLnJvb21Db21wb25lbnQuZW5lbXkubWFuYSA9IHRoaXMucm9vbUNvbXBvbmVudC5lbmVteS5tYW5hIC0gZW5lbXlTcGVsbC5tYW5hO1xyXG4gICAgdGhpcy5yb29tQ29tcG9uZW50LnBsYXllci5oZWFsdGggPSB0aGlzLnJvb21Db21wb25lbnQucGxheWVyLmhlYWx0aCAtIGVuZW15U3BlbGwuZGFtYWdlO1xyXG4gICAgdGhpcy5yb29tQ29tcG9uZW50LmNvbWJhdEFycmF5LnB1c2goYFlvdSBsb3N0ICR7ZW5lbXlTcGVsbC5kYW1hZ2V9IGhwYCk7XHJcbiAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh0aGlzLnJvb21Db21wb25lbnQuY29tYmF0QXJyYXkpKTtcclxuICB9XHJcblxyXG5cclxuICBjbGVhclJvb20oKXtcclxuICAgICAgaWYgKHRoaXMucm9vbUNvbXBvbmVudC5lbmVteS5oZWFsdGggPD0gMCkge1xyXG4gICAgICAgIGFsZXJ0KFwiWU9VIENMRUFSRUQgVEhJUyBST09NIVwiKTtcclxuICAgICAgfSBcclxuICAgICAgdGhpcy5yb29tQ29tcG9uZW50LmNsZWFyZWQgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgZmFpbFJvb20oKXtcclxuICAgIGlmICh0aGlzLnJvb21Db21wb25lbnQucGxheWVyLmhlYWx0aCA8PSAwKSB7XHJcbiAgICAgIGFsZXJ0KFwiWU9VIEZBSUxFRCBUSElTIFJPT00hXCIpXHJcbiAgICB9XHJcbiAgICB0aGlzLnJvb21Db21wb25lbnQuY2xlYXJlZCA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgZGlzcGxheUNvbWJhdEFycmF5KCl7XHJcblxyXG4gIH1cclxuXHJcbiAgY2xlYXJDb21iYXRBcnJheSgpe1xyXG4gICAgdGhpcy5yb29tQ29tcG9uZW50LmNvbWJhdEFycmF5ID0gW107XHJcbiAgfVxyXG4gIFxyXG59Il19